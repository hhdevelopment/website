"use strict";(self.webpackChunksoftwarity=self.webpackChunksoftwarity||[]).push([[7857],{3268:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>t,toc:()=>a});var i=s(5893),r=s(1151);const o={slug:"https",title:"HTTPS - HTTP/2",authors:"fachache",tags:[]},c=void 0,t={id:"doc/conf/https",title:"HTTPS - HTTP/2",description:"Dans cette section nous allons voir comment configurer ARCHWAY pour que le serveur soit accessible en HTTPS et activer le HTTP/2.",source:"@site/versioned_docs/version-1.0.1/doc/conf/https.md",sourceDirName:"doc/conf",slug:"/doc/conf/https",permalink:"/1.0.1/doc/conf/https",draft:!1,unlisted:!1,editUrl:"https://github.com/softwarity/website/tree/main/versioned_docs/version-1.0.1/doc/conf/https.md",tags:[],version:"1.0.1",frontMatter:{slug:"https",title:"HTTPS - HTTP/2",authors:"fachache",tags:[]},sidebar:"docuSidebar",previous:{title:"Fichiers",permalink:"/1.0.1/doc/conf/files"},next:{title:"Clusterization",permalink:"/1.0.1/doc/conf/custerization"}},l={},a=[{value:"Certificats autog\xe9n\xe9r\xe9s",id:"certificats-autog\xe9n\xe9r\xe9s",level:2},{value:"Autorit\xe9s certifiantes",id:"autorit\xe9s-certifiantes",level:3},{value:"Creation du <code>.p12</code>",id:"creation-du-p12",level:3},{value:"Certificats fournis",id:"certificats-fournis",level:2},{value:"Custom domaine",id:"custom-domaine",level:3},{value:"Afficher les infos",id:"afficher-les-infos",level:3},{value:"Utilisation du <code>.p12</code>",id:"utilisation-du-p12",level:2},{value:"Explications",id:"explications",level:3},{value:"D\xe9marrage du projet",id:"d\xe9marrage-du-projet",level:3}];function d(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.a)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Dans cette section nous allons voir comment configurer ",(0,i.jsx)(n.code,{children:"ARCHWAY"})," pour que le serveur soit accessible en ",(0,i.jsx)(n.code,{children:"HTTPS"})," et activer le ",(0,i.jsx)(n.code,{children:"HTTP/2"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"ARCHWAY"})," utilise un fichier ",(0,i.jsx)(n.code,{children:".p12"})," pour importer les certificats et cl\xe9s n\xe9cessaires."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["Un fichier ",(0,i.jsx)(n.code,{children:".p12"})," est un format de fichier binaire utilis\xe9 pour stocker le certificat du serveur, ainsi que toute la cha\xeene de certificats et la cl\xe9 priv\xe9e dans un seul fichier encrypt\xe9. Il est \xe9galement connu sous le nom de fichier PKCS#12, qui est un standard pour le stockage de cl\xe9s priv\xe9es et de certificats."]})}),"\n",(0,i.jsx)(n.h2,{id:"certificats-autog\xe9n\xe9r\xe9s",children:"Certificats autog\xe9n\xe9r\xe9s"}),"\n",(0,i.jsxs)(n.p,{children:["Nous allons commencer avec un fichier ",(0,i.jsx)(n.code,{children:".p12"})," autog\xe9n\xe9r\xe9 pour ",(0,i.jsx)(n.code,{children:"localhost"}),".",(0,i.jsx)(n.br,{}),"\n","Ce dernier pourra \xeatre utilis\xe9 localement sur le poste du d\xe9veloppeur par exemple."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["La proc\xe9dure est d\xe9crite pour une distribution ",(0,i.jsx)(n.code,{children:"linux"})," ",(0,i.jsx)(n.code,{children:"debian"}),"."]})}),"\n",(0,i.jsx)(n.h3,{id:"autorit\xe9s-certifiantes",children:"Autorit\xe9s certifiantes"}),"\n",(0,i.jsxs)(n.p,{children:["Nous allons g\xe9n\xe9rer une nouvelle ",(0,i.jsx)(n.code,{children:"CA"})," locale qui \xe9mettra et signera  notre fichier ",(0,i.jsx)(n.code,{children:".p12"})]}),"\n",(0,i.jsx)(n.p,{children:"Mise \xe0 jour et installation des outils"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ sudo update-ca-certificates\n$ sudo apt install libnss3-tools mkcert\n"})}),"\n",(0,i.jsxs)(n.p,{children:["G\xe9n\xe9ration de la ",(0,i.jsx)(n.code,{children:"CA"})," locale"]}),"\n",(0,i.jsx)(n.p,{children:"La commande suivate va cr\xe9er et installer une CA localement dans vos differents navigateurs sur votre poste."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ sudo mkcert -install\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"The local CA is now installed in the system trust store! \ud83d\udc4d\nThe local CA is now installed in the Firefox and/or Chrome/Chromium trust store (requires browser restart)! \ud83e\udd8a\nThe local CA is now installed in Java's trust store! \ud83d\udc4d\n"})}),"\n",(0,i.jsxs)(n.h3,{id:"creation-du-p12",children:["Creation du ",(0,i.jsx)(n.code,{children:".p12"})]}),"\n",(0,i.jsxs)(n.p,{children:["Nous allons cr\xe9er un magasin contenant les certificats et cl\xe9 pour ",(0,i.jsx)(n.code,{children:"localhost"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ mkcert -p12-file server-keystore.p12 -pkcs12 localhost\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Created a new certificate valid for the following names \ud83d\udcdc\n - "localhost"\n\nThe PKCS#12 bundle is at "server-keystore.p12" \u2705\n\nThe legacy PKCS#12 encryption password is the often hardcoded default "changeit" \u2139\ufe0f\n\nIt will expire on 17 April 2026 \ud83d\uddd3\n'})}),"\n",(0,i.jsx)(n.h2,{id:"certificats-fournis",children:"Certificats fournis"}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Si vous avez un fichier ",(0,i.jsx)(n.code,{children:".p12"})," pour votre domaine, passez \xe0 la section suivante."]})}),"\n",(0,i.jsxs)(n.p,{children:["Si votre registraire vous fournit un certificat et une cl\xe9 priv\xe9e, utilisez la proc\xe9dure suivante pour cr\xe9er le fichier ",(0,i.jsx)(n.code,{children:".p12"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"custom-domaine",children:"Custom domaine"}),"\n",(0,i.jsxs)(n.p,{children:["Si votre registraire vous fournit pour votre domaine ",(0,i.jsx)(n.code,{children:"mydomain.com"})," une cl\xe9 priv\xe9e et un certificat ",(0,i.jsx)(n.code,{children:"ssl"}),". Vous pouvez g\xe9n\xe9rer un magasin au format ",(0,i.jsx)(n.code,{children:".p12"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# mydomain.com_private_key.key\n# mydomain.com_ssl_certificate.cer\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\xc0 partir de ces fichiers g\xe9n\xe9rez le fichier ",(0,i.jsx)(n.code,{children:"server-keystore.p12"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"openssl pkcs12 -export -out server-keystore.p12 -inkey mydomain.com_private_key.key -in mydomain.com_ssl_certificate.cer\n# create password\n"})}),"\n",(0,i.jsx)(n.h3,{id:"afficher-les-infos",children:"Afficher les infos"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"keytool -list -keystore server-keystore.p12 -storetype PKCS12 -v\n"})}),"\n",(0,i.jsxs)(n.h2,{id:"utilisation-du-p12",children:["Utilisation du ",(0,i.jsx)(n.code,{children:".p12"})]}),"\n",(0,i.jsxs)(n.p,{children:["Pour ajouter le certificat \xe0 ",(0,i.jsx)(n.code,{children:"ARCHWAY"})," et ainsi activer, le ",(0,i.jsx)(n.code,{children:"https"})," et le ",(0,i.jsx)(n.code,{children:"http/2"}),", nous allons modifier le ",(0,i.jsx)(n.code,{children:"docker-compose.yml"})," utilis\xe9 dans le tutoriel pour ajouter le montage du magasin ",(0,i.jsx)(n.code,{children:".p12"})," dans l'image ",(0,i.jsx)(n.code,{children:"archway"}),"."]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(n.code,{children:"docker-compose.yml"})}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",metastring:'title="docker-compose.yml" showLineNumbers',children:"version: '3.8'\nservices:\n  archway:\n    image: ghcr.io/softwarity/archway-ce:latest\n    ports:\n      # highlight-next-line\n      - 443:8443 # HTTPS\n    volumes:\n      # highlight-next-line\n      - ./server-keystore.p12:/server-keystore.p12:ro\n    environment:\n      # highlight-start\n      SERVER_PORT: 8443\n      SSL: \"true\"\n      SSL_KEY_STORE_TYPE: PKCS12\n      SSL_KEY_STORE: server-keystore.p12\n      SSL_KEY_STORE_PASSWORD: changeit\n      SSL_KEY_ALIAS: 1\n      # highlight-end\n      MONGODB_HOST: mongodb \n      MONGODB_DB_NAME: archway\n      MONGODB_USER: admin\n      MONGODB_PWD: changeit\n\n  mongodb:\n    image: mongo # official image  \n    volumes:\n      - mongodb_data:/data/db\n    environment:\n      MONGO_INITDB_DATABASE: archway\n      MONGO_INITDB_ROOT_USERNAME: admin\n      MONGO_INITDB_ROOT_PASSWORD: changeit\nvolumes:\n  mongodb_data:\n\n"})})]}),"\n",(0,i.jsx)(n.h3,{id:"explications",children:"Explications"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"./server-keystore.p12:/server-keystore.p12:ro\n"})}),"\n",(0,i.jsxs)(n.p,{children:["La ligne ",(0,i.jsx)(n.code,{children:"./server-keystore.p12:/server-keystore.p12:ro"})," d\xe9finit que l'on va monter le magasin ",(0,i.jsx)(n.code,{children:".p12"})," \xe0 la racine du conteneur. On pr\xe9cise que c'est en lecture seule ",(0,i.jsx)(n.code,{children:"ro"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Dans notre cas, le fichier ",(0,i.jsx)(n.code,{children:"server-keystore.p12"})," et le fichier ",(0,i.jsx)(n.code,{children:"docker-compose.yml"})," doivent \xeatre au m\xeame niveau."]}),"\n",(0,i.jsx)(n.p,{children:"Adaptez au besoin le mot de passe bien s\xfbr."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:"- 443:8443 # HTTPS\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Ceci expose le port ",(0,i.jsx)(n.code,{children:"8443"})," du conteneur sur le port local ",(0,i.jsx)(n.code,{children:"443"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Si le port 443 n'est pas libre vous povez en utiliser un autre."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yml",children:'SERVER_PORT: 8443\nSSL: "true"\nSSL_KEY_STORE_TYPE: PKCS12\nSSL_KEY_STORE: server-keystore.p12\nSSL_KEY_STORE_PASSWORD: changeit\nSSL_KEY_ALIAS: 1\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SERVER_PORT"})," d\xe9finit le port ",(0,i.jsx)(n.code,{children:"HTTPS"})," interne d'\xe9coute du serveur."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SSL"})," active le ",(0,i.jsx)(n.code,{children:"SSL"}),", le ",(0,i.jsx)(n.code,{children:"HTTPS"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SSL_KEY_STORE_TYPE"})," Type du magasin, normalement ",(0,i.jsx)(n.code,{children:"PKCS12"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SSL_KEY_STORE"})," Le magasin au format ",(0,i.jsx)(n.code,{children:".p12"})," que l'on a mont\xe9."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SSL_KEY_STORE_PASSWORD"})," Le mot de passe de la cl\xe9 priv\xe9e."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"SSL_KEY_ALIAS"})," L'alias du certificat dans le magasin."]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsx)(n.p,{children:"Pour connaitre la liste des alias dans le magasin utiliser la commande:"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"keytool -list -keystore server-keystore.p12 -storetype PKCS12 -v\n"})})]}),"\n",(0,i.jsx)(n.h3,{id:"d\xe9marrage-du-projet",children:"D\xe9marrage du projet"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker compose -f docker-compose.yml pull\ndocker compose -f docker-compose.yml up -d\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Connexion: ",(0,i.jsx)(n.a,{href:"https://localhost:443/login",children:"https://localhost:443/login"})]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["le lien pr\xe9c\xe9dent utilise ",(0,i.jsx)(n.code,{children:"localhost"}),", il faut bien sur adater cela avec le ",(0,i.jsx)(n.code,{children:"DNS"})," li\xe9 au certificat utilis\xe9."]})})]})}function h(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>t,a:()=>c});var i=s(7294);const r={},o=i.createContext(r);function c(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);