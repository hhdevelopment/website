"use strict";(self.webpackChunksoftwarity=self.webpackChunksoftwarity||[]).push([[1183],{7824:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>a,metadata:()=>r,toc:()=>l});var i=n(5893),o=n(1151);const a={slug:"test-api",title:"Test API",authors:"fachache",tags:[]},s=void 0,r={id:"tuto/test/test-api",title:"Test API",description:"Finally, to conclude, we will test the API Gateway by making a call to the application's API. This means bypassing the user interface.",source:"@site/docs/tuto/test/test-api.mdx",sourceDirName:"tuto/test",slug:"/tuto/test/test-api",permalink:"/tuto/test/test-api",draft:!1,unlisted:!1,editUrl:"https://github.com/softwarity/website/tree/main/docs/tuto/test/test-api.mdx",tags:[],version:"current",frontMatter:{slug:"test-api",title:"Test API",authors:"fachache",tags:[]},sidebar:"tutoSidebar",previous:{title:"Test Forward Headers",permalink:"/tuto/test/test-headers"}},c={},l=[{value:"Authenticate",id:"authenticate",level:2},{value:"Token JWT",id:"token-jwt",level:2}];function h(e){const t={admonition:"admonition",code:"code",h2:"h2",p:"p",pre:"pre",...(0,o.a)(),...e.components},{Details:n}=t;return n||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Finally, to conclude, we will test the API Gateway by making a call to the application's API. This means bypassing the user interface."}),"\n",(0,i.jsx)(t.p,{children:"To do this, we will authenticate using the token previously created."}),"\n",(0,i.jsxs)(t.p,{children:["Authentication will return a ",(0,i.jsx)(t.code,{children:"JWT"})," ticket which will allow us to access the ",(0,i.jsx)(t.code,{children:"/get"})," API previously tested via the user interface."]}),"\n",(0,i.jsx)(t.admonition,{type:"warning",children:(0,i.jsx)(t.p,{children:"Be aware that JWT tokens are only valid for 15 minutes."})}),"\n",(0,i.jsx)(t.h2,{id:"authenticate",children:"Authenticate"}),"\n",(0,i.jsxs)(t.p,{children:["Open a terminal and execute the following command, replacing ",(0,i.jsx)(t.code,{children:"0f6f8cf5-c68e-4236-982e-0edc16d2438a"})," with the token you previously created:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'curl -D - -X POST http://localhost:8080/api/jwt/v1/auth -H "Content-Type: text/plain" -d "0f6f8cf5-c68e-4236-982e-0edc16d2438a"\n'})}),"\n",(0,i.jsx)(t.p,{children:"You should receive something similar to this:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'HTTP/1.1 200 OK\nContent-Type: application/json\nCache-Control: no-cache, no-store, max-age=0, must-revalidate\nPragma: no-cache\nExpires: 0\nX-Content-Type-Options: nosniff\nX-Frame-Options: DENY\nX-XSS-Protection: 0\nReferrer-Policy: no-referrer\ncontent-length: 1291\n\n{\n  "access_token":"eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJqdGkiOiI4ZDQzNjM4Ni05ZjI5LTQxNzAtYTgwYS1kYTBiMGFlMmZiYjIiLCJ1c2VybmFtZSI6ImFyY2h3YXkiLCJyb2xlcyI6WyJIVFRQQklOX1RFU1RFUiJdLCJvcmdhbml6YXRpb25JZCI6IjY2M2EzNzE2OGEyNTM2MTM0Zjc1YmU4NiIsIm9yZ2FuaXphdGlvbk5hbWUiOiJNQUlOIiwic3ViIjoiNjYzYTI1YTM4YTI1MzYxMzRmNzViZTQyIiwiaXNzIjoiYXJjaHdheSIsImlhdCI6MTcxNzE4NDMwOCwibmJmIjoxNzE3MTg0MzA4LCJleHAiOjE3MTcxODUyMDh9.Tav4fVDfaWZi5qdMlnH1I14HCV4HGIG-bVgWCAq1RkqWveEhQpYG8goII9mFY6DseyV6h6LZAUu_kbgH0Nf9NO_rL-LyUid7_vrxuDoZUGZrDJ7H5NUocqz5tP9-4bByjK4APFq5jJbLtLDYbJLUrUE5dyc5yyGoCuweYBr-4hUC8GCC6vOck2a_iJ6_DZuJ9kY9oclTT6oJu_3xZgtBs7xeZtOK-FE2cNqS0jND5_S_p1xvO07QC4A5DwNRCkWBDrAjuo1a80BS3zybDh27Nspk-IzAwjoRAgdABH7jPyKYP_8vGLuF2Aiyz4y_rAa_3opikm97XdVRSv2iu-ImyQ",\n  "refresh_token":"eyJ0eXAiOiJSRUZSRVNIIiwiYWxnIjoiUlMyNTYifQ.eyJzdWIiOiI2NjNhMjVhMzhhMjUzNjEzNGY3NWJlNDIiLCJpc3MiOiJhcmNod2F5IiwiaWF0IjoxNzE3MTg0MzA4LCJuYmYiOjE3MTcxODQzMDgsImV4cCI6MTcxNzIwNTkwOH0.LUpejsaeJhdTo-NXPf7iYWR1SrJpcNICxJJJusRb0RIc-fMPGuU7ipuSUpK8JVvwMlOXbh6wp5shzOAw8op6DnoSu1fmy_lVgTHy8HpfebdJcKuKyknmT7DAENj1cpPZ4trodlH8q2Yn3D5d9gw9CKso84dt0wy9uJv8tcqP025oX6ge-f1bg-kvXnE4T8Y-HF5K7gyWC-q2EkgllPeM7BLap3AANX7ESqh4dW4jUgZLiZXhwqMNft_dyy-mbAPgYxWHA5_XJbZGr2K7ebY7Agi8Ytu8Vlm0WAeaTwRMdgt48QT7S6eUyqWgMOZdYHhCk5beGyl5BPTJC39M9XOi_g"\n}\n'})}),"\n",(0,i.jsx)(t.h2,{id:"token-jwt",children:"Token JWT"}),"\n",(0,i.jsxs)(t.p,{children:["The part that interests us here is ",(0,i.jsx)(t.code,{children:"access_token"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["This is the JWT token that will allow us to access the ",(0,i.jsx)(t.code,{children:"/get"})," API."]}),"\n",(0,i.jsxs)(t.p,{children:["All we have to do is make a call to the ",(0,i.jsx)(t.code,{children:"/get"})," API."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:"curl -v -k http://127.0.0.1:8080/get -H 'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJqdGkiOiI4ZDQzNjM4Ni05ZjI5LTQxNzAtYTgwYS1kYTBiMGFlMmZiYjIiLCJ1c2VybmFtZSI6ImFyY2h3YXkiLCJyb2xlcyI6WyJIVFRQQklOX1RFU1RFUiJdLCJvcmdhbml6YXRpb25JZCI6IjY2M2EzNzE2OGEyNTM2MTM0Zjc1YmU4NiIsIm9yZ2FuaXphdGlvbk5hbWUiOiJNQUlOIiwic3ViIjoiNjYzYTI1YTM4YTI1MzYxMzRmNzViZTQyIiwiaXNzIjoiYXJjaHdheSIsImlhdCI6MTcxNzE4NDMwOCwibmJmIjoxNzE3MTg0MzA4LCJleHAiOjE3MTcxODUyMDh9.Tav4fVDfaWZi5qdMlnH1I14HCV4HGIG-bVgWCAq1RkqWveEhQpYG8goII9mFY6DseyV6h6LZAUu_kbgH0Nf9NO_rL-LyUid7_vrxuDoZUGZrDJ7H5NUocqz5tP9-4bByjK4APFq5jJbLtLDYbJLUrUE5dyc5yyGoCuweYBr-4hUC8GCC6vOck2a_iJ6_DZuJ9kY9oclTT6oJu_3xZgtBs7xeZtOK-FE2cNqS0jND5_S_p1xvO07QC4A5DwNRCkWBDrAjuo1a80BS3zybDh27Nspk-IzAwjoRAgdABH7jPyKYP_8vGLuF2Aiyz4y_rAa_3opikm97XdVRSv2iu-ImyQ'\n"})}),"\n",(0,i.jsx)(t.p,{children:"With the result:"}),"\n",(0,i.jsxs)(n,{children:[(0,i.jsx)("summary",{children:(0,i.jsx)(t.code,{children:"Result"})}),(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-bash",children:'*   Trying 127.0.0.1:8080...\n* Connected to 127.0.0.1 (127.0.0.1) port 8080 (#0)\n> GET /get HTTP/1.1\n> Host: 127.0.0.1:8080\n> User-Agent: curl/7.88.1\n> Accept: */*\n> Authorization: Bearer ...\n> \n< HTTP/1.1 200 OK\n< date: Fri, 31 May 2024 19:39:59 GMT\n< content-type: application/json\n< server: gunicorn/19.9.0\n< access-control-allow-origin: *\n< access-control-allow-credentials: true\n< content-length: 1414\n< x-http2-stream-id: 3\n< Cache-Control: no-cache, no-store, max-age=0, must-revalidate\n< Pragma: no-cache\n< Expires: 0\n< X-Content-Type-Options: nosniff\n< X-Frame-Options: DENY\n< X-XSS-Protection: 0\n< Referrer-Policy: no-referrer\n< \n{\n  "args": {}, \n  "headers": {\n    "Accept": "*/*", \n    "Accept-Language": "en", \n    "Authorization": "Bearer ...", \n    "Content-Length": "0", \n    "Forwarded": "proto=http;host=\\"127.0.0.1:8080\\";for=\\"127.0.0.1:39042\\"", \n    "Host": "httpbin.org", \n    "Organizationid": "663a37168a2536134f75be86", \n    "Organizationname": "MAIN", \n    "Remote-User": "663a25a38a2536134f75be42", \n    "Roles": "[\\"HTTPBIN_TESTER\\"]", \n    "User-Agent": "curl/7.88.1", \n    "Username": "archway", \n    "X-Amzn-Trace-Id": "Root=1-665a278f-5ced49262d8633411e984471", \n    "X-Forwarded-Host": "127.0.0.1:8080"\n  }, \n  "origin": "127.0.0.1, 86.247.228.169", \n  "url": "https://127.0.0.1:8080/get"\n}\n* Connection #0 to host 127.0.0.1 left intact\n'})})]}),"\n",(0,i.jsx)(t.p,{children:"If we decode the JWT, we have:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n  "typ": "JWT",\n  "alg": "RS256"\n}\n{\n  "jti": "8d436386-9f29-4170-a80a-da0b0ae2fbb2",\n  "username": "archway",\n  "roles": ["HTTPBIN_TESTER"],\n  "organizationId": "663a37168a2536134f75be86",\n  "organizationName": "MAIN",\n  "sub": "663a25a38a2536134f75be42",\n  "iss": "archway", // Note: here it is the name of the issuing application\n  "iat": 1717184308,\n  "nbf": 1717184308,\n  "exp": 1717185208\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"It is of course signed, to ensure its authenticity."})]})}function d(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>r,a:()=>s});var i=n(7294);const o={},a=i.createContext(o);function s(e){const t=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:s(e.components),i.createElement(a.Provider,{value:t},e.children)}}}]);